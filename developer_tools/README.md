# Developer Tools

This folder contains GUI tools and utilities to prepare SCARA motion data using JSON/CSV/PVT workflows.

## 1) `motion_designer.py`
A GUI tool to build motion sequences, save/load motion lists (JSON), and run conversion to a PVT file.

### Overview
- Builds a motion table with: `Index`, `Type`, `Details`.
- Main motion types:
  - `pvt_coor`
  - `pvt_angle`
  - `pvt_csv`
  - `pause`
  - `repeat`
- `Export G-code` runs:
  - `python3 pvt_generator.py --json <json_file> --preview <0|1>`

### Configuration / Parameters
`motion_designer.py` does not use the global `config.json`.  
Its configuration is entered per motion item in the GUI.

- `pvt_coor`
  - `z, x, y, c, t_arm, t_servo`
  - sync option: `t_arm = t_servo`
- `pvt_angle`
  - `angle_1, angle_2, angle_3, angle_4, t_arm, t_servo`
  - sync option: `t_arm = t_servo`
- `pvt_csv`
  - `csv, v_max, v_safe, acc_dec, offset_z`
  - autoset option: `v_safe = v_max / 10`
- `pause`
  - `t_wait`
- `repeat`
  - `from_index, to_index, how_many_times`

Important notes:
- When adding `pvt_csv`, the app tries to read the first CSV row and automatically inserts a `pvt_coor` pre-motion before `pvt_csv`.
- Working paths use the script directory (`base_dir`) so CSV and `pvt_generator.py` calls stay consistent.

### Outputs
Outputs produced by `motion_designer.py`:
- Motion JSON file from `Save` (list of objects with `Index`, `Type`, `Details`).
- During `Export G-code`, outputs are generated by `pvt_generator.py`:
  - `<basename>.pvt` (final PVT CSV)
  - temporary `resampled_<basename>.json` (created, then removed at the end of the pipeline)
- Optional trajectory animation preview (if `--preview 1`).

---

## 2) `task_gui_stream_pvt.py`
A GUI task scheduler (Pickup/Place/Shuttle/Park/Home) that scans motion CSV files, converts trajectories into PVT streaming points, and sends commands via ZMQ.

### Configuration (`config.json`)
Default keys are defined in `DEFAULT_CONFIG`:

- `motions_dir`
  - Source folder for motion CSV scanning.
- `z_by_task`
  - `pickup.z_base_mm`, `pickup.z_step_mm`
  - `place.z_base_mm`, `place.z_step_mm`
  - `shuttle.z_base_mm`, `shuttle.z_step_mm`
  - `park.z_base_mm`, `park.z_step_mm`
- `pvt`
  - `dt_ms` (sampling period per PVT point)
- `profile`
  - `step_mm`
  - `angle_threshold`
  - `acc_dec_ms`
  - `v_max`
  - `v_safe`
  - `offset_z_global`
- `straight_pre_motion`
  - `enable`
  - `yaw_arc_radius_mm`
  - `min_distance_mm`
- `zmq`
  - `endpoint`
  - `mode` (`PUB_BIND` / `PUB_CONNECT` / `PUSH_CONNECT`)
  - `dry_run`

Config source on startup:
- Uses `TASK_GUI_CONFIG` env var if set.
- Otherwise uses local `config.json` in the same folder.

Settings UI:
- Supports `Load`, `Save`, and `Apply` for JSON config from the `Settings` dialog.
- Supports CSV scanning and CSV selection from the `CSV Selection` section.

### Outputs
Main outputs of `task_gui_stream_pvt.py`:
- PVT command stream over ZMQ (if `dry_run=false`) with payload:
  - `{"command":"pvt_point","p1","v1","p2","v2","p3","v3","p4","v4","t_ms"}`
- Runtime logs in the `Log` panel (scan, plan, done, run status).
- No trajectory file is generated by default.
- If `Save` is pressed in Settings, a config JSON file is written to disk.

---

## Summary of Files/Folders in `developer_tools`

- `README.md`
  - Documentation for this folder.
- `motion_designer.py`
  - GUI editor for motion sequence creation (JSON source generator).
- `task_gui_stream_pvt.py`
  - Task scheduler + PVT streamer via ZMQ.
- `pvt_generator.py`
  - Converts motion JSON into `.pvt` and can show optional preview animation.
- `csv_viewer.py`
  - CSV viewer utility for trajectory inspection.
- `viewer.py`
  - Additional viewer utility (legacy/experimental).
- `config.json`
  - Configuration file for `task_gui_stream_pvt.py`.
- `motions.json`
  - Example motion sequence file.
- `motions.pvt`, `motions_pvt.csv`
  - Example PVT trajectory outputs.
- `pickup_shelf_20250922.csv`, `place_shelf_20250922.csv`, `demo_shuttle.csv`
  - Example input motion CSV files.
- `Scara_Arm_CSV_files/`
  - Task CSV package folder (Pickup/Place/Home) for scheduler usage.
- `resampled/`
  - Intermediate/utility output folder from generator workflows.
- `proto/`
  - Prototype/experimental scripts for motion pipeline development.
- `__pycache__/`
  - Python bytecode cache.
